C51 COMPILER V9.54   KEY                                                                   02/16/2019 16:02:38 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Output\key.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE Code\key.c ROM(COMPACT) OPTIMIZE(8,SIZE) BROWSE INCDIR(..\..\Include;..\Inc
                    -lude) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\key.lst) OBJECT(.\Output\key.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "SFR_Macro.h"
   3          #include "Function_define.h"
   4          #include "dataflash.h"
   5          #include "key.h"
   6          
   7          #define Fun_KEY_INPUT   P17_Input_Mode
   8          #define Fun_KEY_P17             P17
   9          #define Safety_KEY_INPUT        P30_Input_Mode
  10          #define Safety_KEY              P30
  11          #define Charging_KEY_INPUT      P05_Input_Mode
  12          #define Charging_KEY    P05
  13          
  14          unsigned char curKey,preKey;
  15          unsigned int debounce;
  16          unsigned char Safety_key_debounce;
  17          unsigned char Charging_key_debounce;
  18          extern char is_5ms_Flag;
  19          
  20          extern bit BIT_TMP;
  21          
  22          
  23          void KeyInit(void)
  24          {
  25   1              curKey = 0;
  26   1              preKey = 0;
  27   1              debounce = 0;
  28   1              Safety_key_debounce = 0;
  29   1              Charging_key_debounce = 0;
  30   1              Fun_KEY_INPUT;
  31   1              Safety_KEY_INPUT;
  32   1              Charging_KEY_INPUT;
  33   1      }
  34          
  35          char KeyScan(void)
  36          {
  37   1              unsigned char keystatus ;
  38   1              keystatus = 0;
  39   1              if (is_5ms_Flag)
  40   1              {
  41   2                      is_5ms_Flag = 0;
  42   2                      curKey = Fun_KEY_P17;
  43   2                      if (curKey != preKey)
  44   2                      {
  45   3                              preKey = curKey;/*
  46   3                              if (debounce>=400)
  47   3                              {
  48   3                                      keystatus = 0x08;
  49   3                              }
  50   3                              else*/ if (debounce > 10)
  51   3                              {
  52   4                                      keystatus = 1;
  53   4                              }       
  54   3                              debounce = 0;
C51 COMPILER V9.54   KEY                                                                   02/16/2019 16:02:38 PAGE 2   

  55   3                      }
  56   2                      else if(curKey == 0)
  57   2                      {
  58   3                              debounce++;
  59   3                              if (debounce >= 500)
  60   3                              {
  61   4                                      debounce = 500;
  62   4                              }
  63   3                              else if (debounce >= 400)
  64   3                              {
  65   4                                      debounce = 500;
  66   4                                      keystatus = 0x08;
  67   4                              }
  68   3                      }
  69   2                      
  70   2                      if (Safety_KEY)
  71   2                      {
  72   3                              Safety_key_debounce = 0;
  73   3                      }
  74   2                      else
  75   2                      {
  76   3                              Safety_key_debounce++;
  77   3                              if (Safety_key_debounce > 20)
  78   3                              {
  79   4                                      Safety_key_debounce = 20;
  80   4                                      keystatus |= 0x02;
  81   4                              }
  82   3                      }
  83   2                      
  84   2                      if (Charging_KEY)
  85   2                      {
  86   3                              Charging_key_debounce = 0;
  87   3                      }
  88   2                      else
  89   2                      {
  90   3                              Charging_key_debounce++;
  91   3                              if (Charging_key_debounce > 20)
  92   3                              {
  93   4                                      Charging_key_debounce = 20;
  94   4                                      keystatus |= 0x04;
  95   4                              }
  96   3                      }
  97   2              }
  98   1              return keystatus;
  99   1      }
 100          
 101          void EnterDPD(void)
 102          {
 103   1              //…Ë÷√P17∞¥º¸ªΩ–—
 104   1          P17_Input_Mode;
 105   1              set_P0S_7;
 106   1              Enable_INT_Port1;
 107   1              Enable_BIT7_FallEdge_Trig;
 108   1          set_EPI;                                                    // Enable pin interrupt
 109   1          set_EA;                     
 110   1              //dpd
 111   1              set_PD;
 112   1              
 113   1              PICON  = PICON & 0xFE;
 114   1      }


C51 COMPILER V9.54   KEY                                                                   02/16/2019 16:02:38 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    228    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
