C51 COMPILER V9.54   LED                                                                   03/23/2019 14:44:07 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN .\Output\led.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE Code\led.c ROM(COMPACT) OPTIMIZE(8,SIZE) BROWSE INCDIR(..\..\Include;..\Inc
                    -lude) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\led.lst) OBJECT(.\Output\led.obj)

line level    source

   1          
   2          
   3          #include "N76E003.h"
   4          #include "SFR_Macro.h"
   5          #include "Function_define.h"
   6          #include "led.h"
   7          #include "motor.h"
   8          
   9          #define LED1_OUTPUT             P13_PushPull_Mode
  10          #define LED2_OUTPUT             P00_PushPull_Mode
  11          #define LED3_OUTPUT             P01_PushPull_Mode
  12          #define LED4_OUTPUT             P03_PushPull_Mode
  13          #define LED_R_OUTPUT    P10_PushPull_Mode
  14          #define LED_G_OUTPUT    P11_PushPull_Mode
  15          #define LED_B_OUTPUT    P15_PushPull_Mode
  16          
  17          #define LED1_SETTING(x)         P13 = x
  18          #define LED2_SETTING(x)         P00 = x
  19          #define LED3_SETTING(x)         P01 = x
  20          #define LED4_SETTING(x)         P03 = x
  21          #define LED_R_SETTING(x)        P10 = x
  22          #define LED_G_SETTING(x)        P11 = x
  23          #define LED_B_SETTING(x)        P15 = x
  24          
  25          extern unsigned char is_5ms_Flag;
  26          unsigned char led_stage=0;
  27          unsigned char led_white_mode;
  28          bit led_rgb_mode;
  29          bit led_white_tog;
  30          unsigned int led_display_time = 0;
  31          extern unsigned char batlevel;
  32          void Init_LED(void)
  33          {
  34   1              LED1_OUTPUT;
  35   1              LED2_OUTPUT;
  36   1              LED3_OUTPUT;
  37   1              LED4_OUTPUT;
  38   1              LED1_SETTING(0);
  39   1              LED2_SETTING(0);
  40   1              LED3_SETTING(0);
  41   1              LED4_SETTING(0);        
  42   1              
  43   1              LED_R_OUTPUT;
  44   1              LED_G_OUTPUT;
  45   1              LED_B_OUTPUT;
  46   1              
  47   1              LED_R_SETTING(0);
  48   1              LED_G_SETTING(0);
  49   1              LED_B_SETTING(0);
  50   1              
  51   1              led_white_mode = 0;
  52   1              led_rgb_mode = 0;
  53   1      }
  54          
C51 COMPILER V9.54   LED                                                                   03/23/2019 14:44:07 PAGE 2   

  55          void DeInit_LED(void)
  56          {
  57   1              P13_OpenDrain_Mode;
  58   1              P00_OpenDrain_Mode;
  59   1              P01_OpenDrain_Mode;
  60   1              P03_OpenDrain_Mode;
  61   1              P10_OpenDrain_Mode;
  62   1              P11_OpenDrain_Mode;
  63   1              P15_OpenDrain_Mode;
  64   1      }
  65          /*
  66          led_type:       LED Or RGB(0:1)
  67          led_value: led value
  68          led_mode:       Normal or Flash(0:1)
  69          */
  70          void LED_WHITE_Set_value(unsigned char led_value)
  71          {
  72   1              LED1_SETTING(led_value&LED1);
  73   1              led_value = led_value >> 1;
  74   1              LED2_SETTING(led_value&LED1);
  75   1              led_value = led_value >> 1;
  76   1              LED3_SETTING(led_value&LED1);
  77   1              led_value = led_value >> 1;
  78   1              LED4_SETTING(led_value&LED1);   
  79   1      }
  80          void LED_WHITE_Setting(unsigned char led_value,unsigned char led_mode)
  81          {
  82   1      //      led_white_mode = led_mode;
  83   1              LED_WHITE_Set_value(led_value);
  84   1              led_display_time = 0;
  85   1              led_white_tog = 0;
  86   1      }
*** WARNING C280 IN LINE 80 OF Code\led.c: 'led_mode': unreferenced local variable
  87          
  88          void LED_RGB_Set_value(unsigned char led_value)
  89          {
  90   1      //      LED_R_SETTING(led_value&LEDR);
  91   1      //      #warning "need update RGB-LED "
  92   1      //      if (led_value&LEDR)
  93   1      //      {
  94   1      //              LED_G_SETTING(1);
  95   1      //              LED_B_SETTING(1);
  96   1      //      }
  97   1      //      else
  98   1      //      {
  99   1      //              led_value = led_value >> 1;
 100   1      //              LED_B_SETTING(led_value&LEDR);
 101   1      //              led_value = led_value >> 1;
 102   1      //              LED_G_SETTING(led_value&LEDR);  
 103   1      //      }
 104   1                      
 105   1                      LED_R_SETTING(led_value&LEDR);
 106   1                      led_value = led_value >> 1;
 107   1                      LED_B_SETTING(led_value&LEDR);  
 108   1                      led_value = led_value >> 1;     
 109   1                      LED_G_SETTING(led_value&LEDR);
 110   1      }
 111          void LED_RGB_Setting(unsigned char led_value,unsigned char led_mode)
 112          {
 113   1              led_rgb_mode = led_mode;
 114   1              LED_RGB_Set_value(led_value);
 115   1      }
C51 COMPILER V9.54   LED                                                                   03/23/2019 14:44:07 PAGE 3   

 116          
 117          unsigned char batlevel_to_led_value(unsigned char stage)
 118          {
 119   1              unsigned char val;
 120   1              if (stage == 1)//stage A
 121   1              {
 122   2                      if (batlevel >= 5)
 123   2                      {
 124   3                              val = 0x0F;
 125   3                      }
 126   2                      else if (batlevel == 4)
 127   2                      {
 128   3                              val = 0x07;
 129   3                      }
 130   2                      else if (batlevel == 3)
 131   2                      {
 132   3                              val = 0x03;
 133   3                      }
 134   2                      else if (batlevel == 2)
 135   2                      {
 136   3                              val = 0x01;
 137   3                      }                       
 138   2              }
 139   1              else if (stage == 4)//stage C
 140   1              {
 141   2                      if (batlevel == 6)      //100%
 142   2                              val = 0x0F;
 143   2                      else if (batlevel == 5) //>75%
 144   2                      {
 145   3                              val = 0x07;
 146   3                      }
 147   2                      else if (batlevel == 4) //50%
 148   2                      {
 149   3                              val = 0x03;
 150   3                      }
 151   2                      else if (batlevel == 3) //25
 152   2                      {
 153   3                              val = 0x01;
 154   3                      }
 155   2                      else
 156   2                              val = 0;
 157   2              }
 158   1              else if (stage == 2)//stage B
 159   1              {
 160   2                      if (batlevel >= 5)      //>75%
 161   2                      {
 162   3                              val = 0x0F;
 163   3                      }
 164   2                      else if (batlevel == 4)//>50%
 165   2                      {
 166   3                              val = 0x07;
 167   3                      }
 168   2                      else if (batlevel == 3)//>25%
 169   2                      {
 170   3                              val = 0x03;
 171   3                      }
 172   2                      else if (batlevel == 2)//>10%
 173   2                      {
 174   3                              val = 0x01;
 175   3                      }
 176   2                      else if (batlevel == 1)//<10%
 177   2                      {
C51 COMPILER V9.54   LED                                                                   03/23/2019 14:44:07 PAGE 4   

 178   3                              val = 0x00;
 179   3                      }
 180   2              }
 181   1              else if (stage == 8)//stage D
 182   1              {
 183   2                      if (batlevel == 6)
 184   2                      {
 185   3                              val = 0x0F;
 186   3                      }
 187   2                      else if (batlevel == 5) //>75%
 188   2                      {
 189   3                              val = 0x07;
 190   3                      }
 191   2                      else if (batlevel == 4)//>50%
 192   2                      {
 193   3                              val = 0x03;
 194   3                      }
 195   2                      else if (batlevel == 3)//>25%
 196   2                      {
 197   3                              val = 0x01;
 198   3                      }
 199   2                      else    //<25%
 200   2                      {
 201   3                              val = 0;
 202   3                      }
 203   2              }
 204   1              return val;
 205   1      }
 206          
 207          void LED_Setting(unsigned char stage,unsigned char batlevel)
 208          {
 209   1              unsigned char temp;
 210   1              led_stage = stage;
 211   1              led_display_time = 0;
 212   1              if (led_stage == 0)
 213   1              {
 214   2                      LED_WHITE_Setting(0,0);
 215   2              }
 216   1              else if (led_stage == 1)        //stage_A
 217   1              {
 218   2                      led_white_mode = 0;
 219   2                      temp = batlevel_to_led_value(led_stage);
 220   2                      LED_WHITE_Setting(temp,0);
 221   2              }
 222   1              else if (led_stage == 4)//stage C
 223   1              {
 224   2                      led_white_mode = 0;
 225   2                      temp = batlevel_to_led_value(led_stage);
 226   2                      LED_WHITE_Setting(temp,0);
 227   2              }
 228   1              else if (led_stage == 2)//stage B
 229   1              {
 230   2                      led_white_mode = 0;
 231   2                      temp = batlevel_to_led_value(led_stage);
 232   2                      if (temp == 0)
 233   2                              LED_WHITE_Setting(1,0);
 234   2                      else
 235   2                              LED_WHITE_Setting(temp,0);
 236   2              }
 237   1              else if (led_stage == 8)//stage D
 238   1              {
 239   2                      led_white_mode = 0;
C51 COMPILER V9.54   LED                                                                   03/23/2019 14:44:07 PAGE 5   

 240   2                      temp = batlevel_to_led_value(led_stage);
 241   2                      LED_WHITE_Setting(temp,0);
 242   2              }
 243   1      }
*** WARNING C280 IN LINE 207 OF Code\led.c: 'batlevel': unreferenced local variable
 244          
 245          void LED_Process(unsigned char stage,unsigned char led_value)
 246          {
 247   1              unsigned char temp;
 248   1              if (led_stage == 1)     //stage
 249   1              {
 250   2                      if (led_display_time == 600)
 251   2                      {
 252   3                              led_stage = 0;
 253   3                              LED_WHITE_Setting(0,0);
 254   3                      }
 255   2              }
 256   1              else if (led_stage == 4)//stage C
 257   1              {
 258   2                      if (led_display_time == 100)
 259   2                      {
 260   3                              led_display_time = 0;
 261   3                              if (led_white_tog == 0)
 262   3                              {
 263   4                                      led_white_tog = 1;
 264   4                                      led_display_time = 1;
 265   4                                      temp = batlevel_to_led_value(led_stage);
 266   4                                      temp = (temp<<1) + 1;
 267   4                                      LED_WHITE_Set_value(temp);
 268   4                              }
 269   3                              else
 270   3                              {
 271   4                                      led_white_tog = 0;
 272   4                                      led_display_time = 0;
 273   4                                      temp = batlevel_to_led_value(led_stage);
 274   4                                      LED_WHITE_Set_value(temp);
 275   4                              }
 276   3                      }               
 277   2              }
 278   1              else if (led_stage == 2)//stage B
 279   1              {
 280   2                      if (led_display_time == 50)
 281   2                      {
 282   3                              led_display_time = 0;
 283   3                              if (led_white_tog == 0)
 284   3                              {
 285   4                                      led_white_tog = 1;
 286   4                                      led_display_time = 1;
 287   4                                      temp = batlevel_to_led_value(led_stage);
 288   4                                      if (temp == 0)
 289   4                                      {
 290   5                                              temp = (temp<<1) + 1;
 291   5                                      }                               
 292   4                                      LED_WHITE_Set_value(temp);
 293   4                              }
 294   3                              else
 295   3                              {
 296   4                                      led_white_tog = 0;
 297   4                                      led_display_time = 0;
 298   4                                      temp = batlevel_to_led_value(led_stage);
 299   4                                      LED_WHITE_Set_value(temp);
 300   4                              }
C51 COMPILER V9.54   LED                                                                   03/23/2019 14:44:07 PAGE 6   

 301   3                      }               
 302   2              }
 303   1              else if (led_stage == 8)//stage D
 304   1              {
 305   2                      if (led_display_time == 100)
 306   2                      {
 307   3                              led_display_time = 0;
 308   3                              if (led_white_tog == 0)
 309   3                              {
 310   4                                      led_white_tog = 1;
 311   4                                      led_display_time = 1;
 312   4                                      temp = batlevel_to_led_value(led_stage);
 313   4                                      temp = (temp<<1) + 1;
 314   4                                      LED_WHITE_Set_value(temp);
 315   4                              }
 316   3                              else
 317   3                              {
 318   4                                      led_white_tog = 0;
 319   4                                      led_display_time = 0;
 320   4                                      temp = batlevel_to_led_value(led_stage);
 321   4                                      LED_WHITE_Set_value(temp);
 322   4                              }
 323   3                      }               
 324   2              }
 325   1      }
*** WARNING C280 IN LINE 245 OF Code\led.c: 'stage': unreferenced local variable
*** WARNING C280 IN LINE 245 OF Code\led.c: 'led_value': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    626    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
