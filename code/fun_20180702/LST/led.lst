C51 COMPILER V9.54   LED                                                                   02/23/2019 14:14:38 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN .\Output\led.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE Code\led.c ROM(COMPACT) OPTIMIZE(8,SIZE) BROWSE INCDIR(..\..\Include;..\Inc
                    -lude) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\led.lst) OBJECT(.\Output\led.obj)

line level    source

   1          
   2          
   3          #include "N76E003.h"
   4          #include "SFR_Macro.h"
   5          #include "Function_define.h"
   6          #include "led.h"
   7          #include "motor.h"
   8          
   9          #define LED1_OUTPUT             P13_PushPull_Mode
  10          #define LED2_OUTPUT             P00_PushPull_Mode
  11          #define LED3_OUTPUT             P01_PushPull_Mode
  12          #define LED4_OUTPUT             P03_PushPull_Mode
  13          #define LED_R_OUTPUT    P10_PushPull_Mode
  14          #define LED_G_OUTPUT    P11_PushPull_Mode
  15          #define LED_B_OUTPUT    P15_PushPull_Mode
  16          
  17          #define LED1_SETTING(x)         P13 = x
  18          #define LED2_SETTING(x)         P00 = x
  19          #define LED3_SETTING(x)         P01 = x
  20          #define LED4_SETTING(x)         P03 = x
  21          #define LED_R_SETTING(x)        P10 = x
  22          #define LED_G_SETTING(x)        P11 = x
  23          #define LED_B_SETTING(x)        P15 = x
  24          
  25          extern unsigned char is_5ms_Flag;
  26          
  27          char led_white_mode;
  28          bit led_rgb_mode;
  29          bit led_white_tog;
  30          unsigned int led_display_time = 0;
  31          
  32          void Init_LED(void)
  33          {
  34   1              LED1_OUTPUT;
  35   1              LED2_OUTPUT;
  36   1              LED3_OUTPUT;
  37   1              LED4_OUTPUT;
  38   1              LED1_SETTING(0);
  39   1              LED2_SETTING(0);
  40   1              LED3_SETTING(0);
  41   1              LED4_SETTING(0);        
  42   1              
  43   1              LED_R_OUTPUT;
  44   1              LED_G_OUTPUT;
  45   1              LED_B_OUTPUT;
  46   1              
  47   1              LED_R_SETTING(0);
  48   1              LED_G_SETTING(0);
  49   1              LED_B_SETTING(0);
  50   1              
  51   1              led_white_mode = 0;
  52   1              led_rgb_mode = 0;
  53   1      }
  54          
C51 COMPILER V9.54   LED                                                                   02/23/2019 14:14:38 PAGE 2   

  55          /*
  56          led_type:       LED Or RGB(0:1)
  57          led_value: led value
  58          led_mode:       Normal or Flash(0:1)
  59          */
  60          void LED_WHITE_Set_value(unsigned char led_value)
  61          {
  62   1              LED1_SETTING(led_value&LED1);
  63   1              led_value = led_value >> 1;
  64   1              LED2_SETTING(led_value&LED1);
  65   1              led_value = led_value >> 1;
  66   1              LED3_SETTING(led_value&LED1);
  67   1              led_value = led_value >> 1;
  68   1              LED4_SETTING(led_value&LED1);   
  69   1      }
  70          void LED_WHITE_Setting(unsigned char led_value,unsigned char led_mode)
  71          {
  72   1              led_white_mode = led_mode;
  73   1              LED_WHITE_Set_value(led_value);
  74   1              led_display_time = 0;
  75   1              led_white_tog = 0;
  76   1      }
  77          
  78          void LED_RGB_Set_value(unsigned char led_value)
  79          {
  80   1      //      LED_R_SETTING(led_value&LEDR);
  81   1      //      #warning "need update RGB-LED "
  82   1      //      if (led_value&LEDR)
  83   1      //      {
  84   1      //              LED_G_SETTING(1);
  85   1      //              LED_B_SETTING(1);
  86   1      //      }
  87   1      //      else
  88   1      //      {
  89   1      //              led_value = led_value >> 1;
  90   1      //              LED_B_SETTING(led_value&LEDR);
  91   1      //              led_value = led_value >> 1;
  92   1      //              LED_G_SETTING(led_value&LEDR);  
  93   1      //      }
  94   1                      
  95   1                      LED_B_SETTING(led_value&LEDB);
  96   1                      led_value = led_value >> 1;
  97   1                      LED_G_SETTING(led_value&LEDB);  
  98   1                      led_value = led_value >> 1;     
  99   1                      LED_R_SETTING(led_value&LEDB);
 100   1      }
 101          void LED_RGB_Setting(unsigned char led_value,unsigned char led_mode)
 102          {
 103   1              led_rgb_mode = led_mode;
 104   1              LED_RGB_Set_value(led_value);
 105   1      }
 106          
 107          void LED_Process(unsigned char led_value)
 108          {
 109   1              if (led_white_mode == 1)
 110   1              {
 111   2                      if (led_display_time == 600)
 112   2                      {
 113   3                              led_display_time = 0;
 114   3                              if (led_white_tog == 0)
 115   3                              {
 116   4                                      led_white_tog = 1;
C51 COMPILER V9.54   LED                                                                   02/23/2019 14:14:38 PAGE 3   

 117   4                                      led_display_time = 1;
 118   4                                      LED_WHITE_Set_value(0);
 119   4                              }
 120   3                              else
 121   3                              {
 122   4                                      led_white_tog = 0;
 123   4                                      led_display_time = 0;
 124   4                                      LED_WHITE_Set_value(led_value);
 125   4                              }
 126   3                      }
 127   2              }
 128   1              else if (led_white_mode == 2)
 129   1              {
 130   2                      if (led_display_time == 200)
 131   2                      {
 132   3                              led_display_time = 0;
 133   3                              if (led_white_tog == 0)
 134   3                              {
 135   4                                      led_white_tog = 1;
 136   4                                      led_display_time = 1;
 137   4                                      led_value = (led_value<<1) + 1;
 138   4                                      LED_WHITE_Set_value(led_value);
 139   4                              }
 140   3                              else
 141   3                              {
 142   4                                      led_white_tog = 0;
 143   4                                      led_display_time = 0;
 144   4                                      LED_WHITE_Set_value(led_value);
 145   4                              }
 146   3                      }               
 147   2              }
 148   1              
 149   1              if (led_rgb_mode)
 150   1              {
 151   2              }
 152   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    206    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
